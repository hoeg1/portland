<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Reiner Knizia's Portland</title>
    <link rel="stylesheet" href="style.css">
    <script src="portland.js" type="module"></script>
  </head>
  <body>
    <div class="board">
      <div id="ai_space"></div>
      <div id="msg_box">Press Start</div>
      <div id="player_space"></div>
      <div id='game_space' style="text-align: right;padding-right: 20px;">
        <select id="n_players">
          <option value="2">２人</option>
          <option value="3">３人</option>
          <option value="4">４人</option>
          <option value="5" selected>５人</option>
        </select>
        <button id="start_button" style="width: 82px;">Start</button>
      </div>
      <center>
        <div id="score_sheet"></div>
        <div id="game_log"></div>
      </center>
    </div>

    <div class="rulebook">
<h2>Portland</h2>
　ポートランドはドイツのゲームデザイナー Reiner Knizia 氏が考案した坊主めくり系のポーカーゲームです。ルールは概ね氏の著作「Blazing Aces!」に従っていますが、プログラムとして処理に困る細かい部分では <a href="https://gamefarm.jp/rule/portland.html">ゲームファーム</a> を参考にしています。以下で説明するルールのほとんどは必要十分にして簡潔なゲームファームの記述を冗長に述べただけのものです。<br>
<br>
　※このゲームは 2023 年版の Firefox 及び 2022 年の Vivaldi(Chrome) と、iOS16 の Safari でのみ動作確認しています。<br>
<h3>参加できる人数</h3>
　２〜５人で遊べますが、４人か５人で遊ぶことをおすすめします。プルダウンリストから人数を選択してください。<br>
<h3>使う道具</h3>
　ジョーカーを除く５２枚のトランプを、全プレイヤーが各々で持ちます。５２枚のカードはゲームに参加する<b>個人の山札</b>になり、他のプレイヤーの手札や山札と混ざることはありません。<br>
<h3>ゲームの目的</h3>
　山札からカードをめくって、少しでも強いポーカー役を作る<b>だけ</b>です。しかしそこには多くのジレンマが用意されています。<br>
<br>
　最初に自分の山札から５枚の場札をめくり、続いて、自分の手番になるたびに「パス」または「ドロー」をします。<br>
<br>
　１．ドローを選んだ場合は自分の山札から１枚をめくり、場のどれか１枚と交換します。交換された場札は捨て札にされ、二度と使うことができません。<br>
　２．パスを選んだ場合、そのラウンドでのプレイは終了です。他のプレイヤー全員がパスするのを待ちます。<br>
<br>
　全員がパスした時、場の５枚のカードをポーカーの役で比べて順位を決めます。最下位以外のすべてのプレイヤーは順位に応じて得点し、その後で、<b>場のカードをすべて捨てて</b>、山札から場に<b>５枚のカードを補充して</b>新しいラウンドを始めます。各プレイヤーの山札には５２枚のカードしかありませんが、毎ラウンド５枚の山札が確実に消費されるということです。<br>
<br>
　そうして<b>全６ラウンド</b>を終えた時、累計得点が最も多いプレイヤーの勝ちです。同点なら引き分けと考えます。<br>
<h3>自分の手番にできること</h3>
　すべてのプレイヤーは５２枚の山札を持ち、そこから５枚を自分の前にめくってプレイを始めます。<br>
<br>
　ランダムに決められたスタートプレイヤーから順に、「目的」で述べた通り、次の２択をします。<br>
<br>
　１）山札から１枚をめくって、そのカードを５枚の場のどこかに置く。<br>
　カードをめくったら最後、そのカードは場の５枚のどこかへ<b>必ず</b>置く必要があります。それが嫌なら引かずに「パス」を選ぶべきです。なお、山札が無い場合はカードを引くことができません。<br>
<br>
　２）パスを宣言する。<br>
　パスを選んだ場合、他の全員がパスするまで手番を飛ばされます。山札が無い場合は強制的に「パス」しなければなりませんし、ラウンドの最初に引く５枚のせいで山札が枯れてしまったときも「パス」しか選択できません。<br>
　パスを選んだプレイヤーは次のラウンドになるまで手番を飛ばされますが、新しいラウンドでは再びプレイできるようになります。<br>
<br>
　そうして全員が「パス」を選んだら、全員の手札を比べて強さを順位付けします。勝敗はよくあるポーカーのルールに従います。<br>
<h3>ポーカーの役</h3>
　有効な役は <a href="https://gamefarm.jp/rule/pokerhand.html">ジョーカー無しのポーカーと同じ</a> で、強い順に以下の通りです。<br>
<ol>
  <li>ロイヤル・フラッシュ……同じスート（マーク）のストレートのうち、AKQJ10 の手札</li>
  <li>ストレート・フラッシュ……同じスートで AKQJ10 以外のストレート</li>
  <li>フォー・オブ・ア・カインド……同じランク（数値）の４枚＋なにか１枚の手札</li>
  <li>フルハウス……スリー・オブ・ア・カインドとワンペアの組み合わせ</li>
  <li>フラッシュ……５枚すべてが同じスート</li>
  <li>ストレート……階段になっている５枚。AKQJ10でも良い</li>
  <li>スリー・オブ・ア・カインド……同じランクの３枚＋なにか２枚</li>
  <li>ツーペア……ワンペアが２組＋なにか１枚</li>
  <li>ワンペア……ペアが１組＋なにか３枚</li>
  <li>ハイカード……手札はあるが、上記のどれでもない。同点なら最もランクの高いカードから強さを比べていく</li>
  <li>ノーハンド……手札が１枚も無い。あらゆる役に負ける</li>
</ol>
　同じ役だった場合は、普通のポーカーのようにカードのハイカード（数字の強さ）で勝敗判定をします。すなわち：<br>
<br><br>
　※いずれの場合もランクはＡが最強で、Ａ＞Ｋ＞Ｑ……４＞３＞２の順です。<br>
<br>
１．役を構成しているカードのうち、ランクが高いほうの勝ち。<br>
　例えば「ＡＡ」のワンペアと「ＱＱ」のワンペアならＡＡの勝ちです。<br>
<br>
２．役を作っている部分のランクが同じなら、役に使われていないカードのランクで勝敗を決めます。<br>
　例えば「ＡＡ５４３」の手札と「ＡＡ５３２」の手札なら、ペア部分は引き分けで、「５」のカードも引き分けですが、続く「４」と「３」では４が強いので、４を持つプレイヤーの勝ちです。<br>
<br><br>
　よくわからないなら「ポーカー　引き分け」等でググってください。なお、古いポーカーのルールにのみ存在する「スートによる勝敗判定」は無効です。<br>
<br>
　大雑把に言うと、同じワンペアならまずはペア部分のランクを比べ、同点ならペアでない部分のうちランクが強いほう（Ａが最強、２が最弱）を比べて決着をつけるということです。滅多に発生しませんが、ハイカードを比べてもなお同じ強さだった場合は <b>引き分け</b> です。<br>
　※クニツィア氏のルールでは実はこのあたり曖昧なのですが、ポーカーは普通、上記のように<ruby>引き分け<rt>タイブレーク</rt></ruby>を処理します。<br>
<h3>場札が５枚に満たない時</h3>
　ゲームでは、山札が足りないために４枚以下の手札で勝負する状況が（滅多に無いものの）発生することがあります。<br>
　そのような場合、プレイヤーは<b>フラッシュやストレート、フルハウスを成立させることができません</b>。ペア系の役（ワンペ、ツーペ、スリー・オブ・ア・カインド、フォー・オブ・ア・カインド）は依然として有効ですが、これらの役は手札が５枚の同じペア系に常に敗北します。すなわち:<br>
<br><br>
　１）手札４枚のうち「７」が３枚あるような手札はスリーカードと判定されますが、手札が５枚で「２」が３枚あるような手札に必ず負けます。しかし手札５枚のツーペアなどには勝利します。<br><br>
　２）手札３枚で「５」のスリーカードと、手札４枚のうち「５」が３枚あるスリーカードでは、手札４枚の方がハイカード勝負によって勝利します。手札３枚のハンドにランク勝負可能なハイカードが存在しないためです。<br>
<br><br>
　４枚以下の手札しかない役は、役の表示のすぐ隣に（Ｌ）という但し書きが付きます。<br>
　上記のルールは実際にはクニツィア氏のルールブックで解釈に困る部分で、どう処理するのが正解か迷うところです。このプログラムでは <a href="https://gamefarm.jp/rule/portland.html">ゲームファーム</a> で提案されているルールを参考にしました。<br>
<h3>そして全員が「パス」したら</h3>
　上記のルールで強さを比べ、参加者全員に順位を付けます。<br>
　このとき、もしも同じ順位のプレイヤーが発生したら、それらのプレイヤーが本来つけたはずの順位のうち最も小さい順位を該当する全員の順位とします。<br>
<br>
　例えば４人で遊んでいるとき、１位はフルハウスで、続く２人が<b>完全に</b>同じ手札のツーペアだったとしましょう。そして最下位はワンペアだったとします。<br>
　同点だったツーペアの２人は両方とも <b>３位</b> とみなされ、ワンペアだった最下位のプレイヤーは普通に４位になります。<br>
　※この判定方法はクニツィア氏の本にないルールですが、同点だった場合の記述が無いため、このプログラムではそのようにしています。<br>
<br>
　順位が決まったら、全員が次のように得点します。この得点をｖｐと呼びます。<br>
<br>
　<b>ｖｐ = （参加人数 - 順位） × ラウンド数</b><br>
<br>
　例えば参加人数が５人で、３ラウンド目に２位だった場合　<b>（５人 - ２位）×３ラウンド＝９ｖｐ</b>　が得点です。同じ順位でも４ラウンド目なら　<b>（５人 - ２位）×４ラウンド＝１２ｖｐ</b>　が得られます。順位が上であるほど得点が増えますし、後半のラウンドほど点数が高くなるということです。<br>
<br>
　全員が得点したら新しいラウンドを始めます。全員の場のカードを<b>すべて捨て札</b>にし、各自が、残った自分の山札から５枚になるまで<b>新しいカード</b>をめくります。山札が無いならめくれるだけめくります。このとき、山札がゼロでめくれないなら「手札ゼロ」になり、上記の「ノーハンド」と判定され<b>常に敗北</b>します。<br>
<br>
　前回のラウンドで最後の手番を行った人の次のプレイヤーからプレイを始めます。クニツィア氏のルールには明記されていませんが、仮にそのプレイヤーが脱落していても手番はあるものと解釈し、そのプレイヤーの「強制パス」からプレイを始めます。<br>
<br>
<br>
　——細かな注意書きが多くなりましたが、ルールの骨格は実にシンプルで、「パス」か「めくる」かの２択を繰り返し、どんどん減っていく自分の山札と相談しながら少しでも強いポーカー・ハンドを作るだけです。あなたにポーカーの心得があるなら、一度プレイするだけですぐにルールを理解できるでしょう。<br>
<br>
　<b>全６ラウンド</b>を戦って、累計得点が最も多いプレイヤーの勝ちです。<br>
<br><br>
<h3>ゲーム画面の説明</h3>
　最初に参加人数を決めて「Start」するとゲームが始まります。対戦相手はランダムで、各プログラムに微妙な個性があります。<br>
<br>
　パスしたければ赤い「PASS」ボタンを押してください。そうでなければチェック模様の山札をクリックしします：　山札から１枚がめくられるので、それを場の５枚のどれかに重ねます。プレイでめくるたび——あるいは新ラウンドに入るたびにステータスの「Stock」が減少します。この値は残りの山札の枚数を表しています。<br>
<br>
　ゲーム画面のステータスに「PASSED」とあるプレイヤーはパスをしたことを表しています。そのプレイヤーの場札はラウンドが終わるまで変更されません。<br>
　しかし、そうでないプレイヤーは、場合によっては鬼のようにめくり続けることがあります——勝ったと思ってパスしたあなたの手札を上回ることもあるでしょう：）<br>
<br>
　各ラウンドの最終的な勝者や場札は画面下部に表示されます。<br>
<br>
　なお、対戦相手は一切の<ruby>反則行為<rt>リボーク</rt></ruby>を行いません。プログラムはあなたの山札を作為的にソートしませんし、ＣＰＵたちはあなただけを負かすために結託したりしません。なにせ相手はコンピュータのため<b>カウンティングはゴリゴリにやります</b>が、それ以外では、およそ考えうるあらゆるチートを<b>しません</b>。<br>
<br>
<h3>基本的な戦略</h3>
　最初に５２枚ある個人の山札のうち、５枚 × ６ラウンド = ３０枚は、ラウンドの最初に<b>強制的に消費</b>されてしまいます。<br>
　よって、プレイヤーに引くことができるのは ５２ - ３０ = <b>２２枚だけ</b>ですし、「２２ ÷ ６ラウンド ≒ ３」ですから、毎ラウンドであなたが引いて良い枚数は、平均すると <b>たった３枚しか無い</b> と考えるべきです。といってパスを選べば手札を変更できなくなりますから、まだパスをしていないプレイヤーにより強い役を作られてしまいます……！<br>
<br>
　得られるｖｐはラウンドが経過するほど高くなるよう工夫されているため、各ラウンドで何枚引くかを延々と悩み、一転、ラストラウンドでは引きまくる快感がたまらないゲームです。各手番にプレイヤーが抱くであろう感情に寄り添った、とても美しいゲームデザインです。<br>
<br>
　カウンティングの成否が勝率に直結するようなルールになっていますが、無作為に現れる５２枚のカードを暗記するのは容易ではありませんし、カウンティングができたところで、勝つか負けるかは結局他人のめくり運次第です：）<br>
<br><br><br>
　——本プログラムの（汚ったねえ）ソースの閲覧やダウンロードは、こちらから可能です： <a href="https://github.com/hoeg1/portland">hoeg1/portland</a><br>
<br>
    </div>
  </body>
</html>

